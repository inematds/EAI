<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√∫sica e Ritmo - EAI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            padding: 10px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #feca57;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .medals-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .medal {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            opacity: 0.3;
            transition: all 0.3s;
        }

        .medal.earned {
            opacity: 1;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .medal-bronze { background: linear-gradient(135deg, #cd7f32, #8b4513); }
        .medal-silver { background: linear-gradient(135deg, #c0c0c0, #808080); }
        .medal-gold { background: linear-gradient(135deg, #ffd700, #daa520); }
        .medal-diamond { background: linear-gradient(135deg, #b9f2ff, #00bfff); }

        .game-area {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mode-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .mode-btn:hover, .mode-btn.active {
            background: #4ecdc4;
            transform: scale(1.05);
        }

        .title {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        /* Drum Pad Mode */
        .drum-pad-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 400px;
            margin: 0 auto;
        }

        .drum-pad {
            aspect-ratio: 1;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            font-size: 2.5em;
            border: 3px solid rgba(255,255,255,0.3);
            user-select: none;
        }

        .drum-pad:active, .drum-pad.playing {
            transform: scale(0.95);
            filter: brightness(1.3);
        }

        .drum-pad.kick { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .drum-pad.snare { background: linear-gradient(135deg, #3498db, #2980b9); }
        .drum-pad.hihat { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .drum-pad.tom { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .drum-pad.cymbal { background: linear-gradient(135deg, #1abc9c, #16a085); }
        .drum-pad.clap { background: linear-gradient(135deg, #e67e22, #d35400); }

        .drum-label {
            font-size: 0.4em;
            margin-top: 5px;
            opacity: 0.9;
        }

        /* Simon Says Mode */
        .simon-container {
            text-align: center;
        }

        .simon-message {
            font-size: 1.3em;
            margin-bottom: 20px;
            min-height: 2em;
        }

        .simon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 300px;
            margin: 0 auto 20px;
        }

        .simon-pad {
            aspect-ratio: 1;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.1s;
            opacity: 0.7;
        }

        .simon-pad:hover {
            opacity: 0.85;
        }

        .simon-pad.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 0 30px currentColor;
        }

        .simon-pad.red { background: #e74c3c; color: #e74c3c; }
        .simon-pad.blue { background: #3498db; color: #3498db; }
        .simon-pad.green { background: #2ecc71; color: #2ecc71; }
        .simon-pad.yellow { background: #f1c40f; color: #f1c40f; }

        .simon-score {
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .start-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-btn:hover {
            transform: scale(1.05);
        }

        /* Rhythm Game Mode */
        .rhythm-container {
            text-align: center;
        }

        .rhythm-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .rhythm-note {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s;
        }

        .rhythm-note.current {
            background: #4ecdc4;
            transform: scale(1.2);
            box-shadow: 0 0 20px #4ecdc4;
        }

        .rhythm-note.hit {
            background: #27ae60;
        }

        .rhythm-note.miss {
            background: #e74c3c;
        }

        .hit-zone {
            width: 80px;
            height: 80px;
            border: 4px dashed #4ecdc4;
            border-radius: 50%;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            transition: all 0.2s;
        }

        .hit-zone.perfect {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.3);
        }

        .hit-zone.miss {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.3);
        }

        .tap-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.1s;
        }

        .tap-btn:active {
            transform: scale(0.95);
        }

        /* Piano Mode */
        .piano-container {
            text-align: center;
        }

        .piano-keys {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }

        .piano-key {
            width: 45px;
            height: 140px;
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 10px;
            font-size: 0.8em;
        }

        .piano-key.white {
            background: linear-gradient(180deg, #fff, #e0e0e0);
            color: #333;
            border: 2px solid #ccc;
        }

        .piano-key.black {
            background: linear-gradient(180deg, #333, #111);
            color: white;
            height: 90px;
            width: 30px;
            margin: 0 -15px;
            z-index: 1;
        }

        .piano-key:active, .piano-key.playing {
            transform: scale(0.98);
        }

        .piano-key.white:active, .piano-key.white.playing {
            background: linear-gradient(180deg, #4ecdc4, #44a08d);
        }

        .piano-key.black:active, .piano-key.black.playing {
            background: linear-gradient(180deg, #555, #333);
        }

        .song-display {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .song-title {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .song-notes {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .song-note {
            padding: 8px 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .song-note.current {
            background: #feca57;
            color: #333;
        }

        .song-note.done {
            background: #27ae60;
        }

        .feedback {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 1.2em;
        }

        .feedback.success {
            background: rgba(39, 174, 96, 0.3);
        }

        .feedback.error {
            background: rgba(231, 76, 60, 0.3);
        }

        @media (max-width: 500px) {
            .drum-pad-container {
                gap: 10px;
            }

            .drum-pad {
                font-size: 2em;
            }

            .piano-key {
                width: 35px;
                height: 100px;
            }

            .piano-key.black {
                height: 65px;
                width: 25px;
                margin: 0 -12px;
            }
        }
    </style>
</head>
<body>
    <div class="stats-bar">
        <div class="stat">
            <div class="stat-value" id="points">0</div>
            <div class="stat-label">Pontos</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="level">1</div>
            <div class="stat-label">N√≠vel</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="streak">0</div>
            <div class="stat-label">Sequ√™ncia</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="best">0</div>
            <div class="stat-label">Recorde</div>
        </div>
    </div>

    <div class="medals-display">
        <div class="medal medal-bronze" id="medal-bronze" title="Iniciante: 100 pontos">üèÖ</div>
        <div class="medal medal-silver" id="medal-silver" title="M√∫sico: 500 pontos">ü•à</div>
        <div class="medal medal-gold" id="medal-gold" title="Artista: 1000 pontos">ü•á</div>
        <div class="medal medal-diamond" id="medal-diamond" title="Maestro: 2000 pontos">üíé</div>
    </div>

    <div class="game-area">
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="drums">ü•Å Bateria</button>
            <button class="mode-btn" data-mode="simon">üéµ Mem√≥ria</button>
            <button class="mode-btn" data-mode="piano">üéπ Piano</button>
            <button class="mode-btn" data-mode="rhythm">üéØ Ritmo</button>
        </div>

        <div id="game-content"></div>

        <div class="feedback" id="feedback"></div>
    </div>

    <script>
        // Audio Context
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Game State
        let gameState = {
            points: 0,
            level: 1,
            streak: 0,
            best: 0,
            currentMode: 'drums',
            simonSequence: [],
            simonPlayerSequence: [],
            simonPlaying: false,
            rhythmNotes: [],
            rhythmIndex: 0,
            pianoSongIndex: 0,
            pianoNoteIndex: 0
        };

        // Sound synthesis
        function playDrumSound(type) {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const noise = audioCtx.createBufferSource();

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            switch(type) {
                case 'kick':
                    osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    gain.gain.setValueAtTime(1, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'snare':
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                    gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'hihat':
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'tom':
                    osc.frequency.setValueAtTime(250, audioCtx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.3);
                    break;
                case 'cymbal':
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'clap':
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                    gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.15);
                    break;
            }
        }

        function playNote(frequency, duration = 0.5) {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.type = 'sine';
            osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);

            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + duration);
        }

        // Piano notes frequencies
        const pianoNotes = {
            'C': 261.63, 'D': 293.66, 'E': 329.63, 'F': 349.23,
            'G': 392.00, 'A': 440.00, 'B': 493.88, 'C2': 523.25
        };

        // Simon colors/sounds
        const simonColors = ['red', 'blue', 'green', 'yellow'];
        const simonFreqs = { red: 329.63, blue: 261.63, green: 392.00, yellow: 440.00 };

        // Songs for piano mode
        const pianoSongs = [
            { name: 'Brilha Brilha Estrelinha', notes: ['C', 'C', 'G', 'G', 'A', 'A', 'G'] },
            { name: 'Parab√©ns', notes: ['G', 'G', 'A', 'G', 'C2', 'B'] },
            { name: 'D√≥ R√© Mi', notes: ['C', 'D', 'E', 'C', 'E', 'C', 'E'] },
            { name: 'Escala Simples', notes: ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'C2'] }
        ];

        // Initialize
        function init() {
            loadProgress();
            updateDisplay();
            updateMedals();
            setupModeButtons();
            loadMode('drums');
        }

        function setupModeButtons() {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    loadMode(btn.dataset.mode);
                });
            });
        }

        function loadMode(mode) {
            gameState.currentMode = mode;
            const content = document.getElementById('game-content');
            hideFeedback();

            switch(mode) {
                case 'drums':
                    loadDrumMode(content);
                    break;
                case 'simon':
                    loadSimonMode(content);
                    break;
                case 'piano':
                    loadPianoMode(content);
                    break;
                case 'rhythm':
                    loadRhythmMode(content);
                    break;
            }
        }

        // DRUM MODE
        function loadDrumMode(container) {
            container.innerHTML = `
                <div class="title">ü•Å Toque na Bateria!</div>
                <div class="drum-pad-container">
                    <div class="drum-pad kick" data-sound="kick">
                        üî¥
                        <span class="drum-label">Bumbo</span>
                    </div>
                    <div class="drum-pad snare" data-sound="snare">
                        üîµ
                        <span class="drum-label">Caixa</span>
                    </div>
                    <div class="drum-pad hihat" data-sound="hihat">
                        üü°
                        <span class="drum-label">Hi-Hat</span>
                    </div>
                    <div class="drum-pad tom" data-sound="tom">
                        üü£
                        <span class="drum-label">Tom</span>
                    </div>
                    <div class="drum-pad cymbal" data-sound="cymbal">
                        üü¢
                        <span class="drum-label">Prato</span>
                    </div>
                    <div class="drum-pad clap" data-sound="clap">
                        üü†
                        <span class="drum-label">Palma</span>
                    </div>
                </div>
            `;

            document.querySelectorAll('.drum-pad').forEach(pad => {
                pad.addEventListener('click', () => {
                    playDrumSound(pad.dataset.sound);
                    pad.classList.add('playing');
                    setTimeout(() => pad.classList.remove('playing'), 100);
                    addPoints(2);
                });
            });
        }

        // SIMON SAYS MODE
        function loadSimonMode(container) {
            container.innerHTML = `
                <div class="simon-container">
                    <div class="title">üéµ Jogo da Mem√≥ria Musical</div>
                    <div class="simon-message" id="simon-message">Clique em Iniciar para come√ßar!</div>
                    <div class="simon-score">Sequ√™ncia: <strong id="simon-score">0</strong></div>
                    <div class="simon-grid">
                        <div class="simon-pad red" data-color="red"></div>
                        <div class="simon-pad blue" data-color="blue"></div>
                        <div class="simon-pad green" data-color="green"></div>
                        <div class="simon-pad yellow" data-color="yellow"></div>
                    </div>
                    <button class="start-btn" onclick="startSimon()">‚ñ∂Ô∏è Iniciar</button>
                </div>
            `;

            document.querySelectorAll('.simon-pad').forEach(pad => {
                pad.addEventListener('click', () => {
                    if (!gameState.simonPlaying) return;
                    simonPlayerInput(pad.dataset.color);
                });
            });
        }

        function startSimon() {
            gameState.simonSequence = [];
            gameState.simonPlayerSequence = [];
            document.getElementById('simon-message').textContent = 'Observe a sequ√™ncia...';
            addToSimonSequence();
        }

        function addToSimonSequence() {
            const color = simonColors[Math.floor(Math.random() * simonColors.length)];
            gameState.simonSequence.push(color);
            document.getElementById('simon-score').textContent = gameState.simonSequence.length;
            playSimonSequence();
        }

        function playSimonSequence() {
            gameState.simonPlaying = false;
            let i = 0;

            const interval = setInterval(() => {
                if (i >= gameState.simonSequence.length) {
                    clearInterval(interval);
                    gameState.simonPlaying = true;
                    gameState.simonPlayerSequence = [];
                    document.getElementById('simon-message').textContent = 'Sua vez! Repita a sequ√™ncia.';
                    return;
                }

                const color = gameState.simonSequence[i];
                highlightSimonPad(color);
                playNote(simonFreqs[color], 0.3);
                i++;
            }, 800);
        }

        function highlightSimonPad(color) {
            const pad = document.querySelector(`.simon-pad.${color}`);
            pad.classList.add('active');
            setTimeout(() => pad.classList.remove('active'), 400);
        }

        function simonPlayerInput(color) {
            highlightSimonPad(color);
            playNote(simonFreqs[color], 0.3);
            gameState.simonPlayerSequence.push(color);

            const index = gameState.simonPlayerSequence.length - 1;
            if (gameState.simonPlayerSequence[index] !== gameState.simonSequence[index]) {
                // Wrong!
                document.getElementById('simon-message').textContent = '‚ùå Errou! Tente novamente.';
                gameState.simonPlaying = false;
                showFeedback('Sequ√™ncia: ' + gameState.simonSequence.length + ' - Tente novamente!', 'error');
                return;
            }

            if (gameState.simonPlayerSequence.length === gameState.simonSequence.length) {
                // Correct sequence!
                addPoints(gameState.simonSequence.length * 10);
                document.getElementById('simon-message').textContent = '‚úÖ Correto!';
                gameState.simonPlaying = false;

                setTimeout(() => {
                    addToSimonSequence();
                }, 1000);
            }
        }

        // PIANO MODE
        function loadPianoMode(container) {
            const song = pianoSongs[gameState.pianoSongIndex % pianoSongs.length];
            gameState.pianoNoteIndex = 0;

            container.innerHTML = `
                <div class="piano-container">
                    <div class="title">üéπ Toque a M√∫sica!</div>
                    <div class="song-display">
                        <div class="song-title">${song.name}</div>
                        <div class="song-notes" id="song-notes">
                            ${song.notes.map((note, i) => `
                                <span class="song-note ${i === 0 ? 'current' : ''}" data-index="${i}">${note}</span>
                            `).join('')}
                        </div>
                    </div>
                    <div class="piano-keys">
                        <div class="piano-key white" data-note="C">C</div>
                        <div class="piano-key black" data-note="C#">C#</div>
                        <div class="piano-key white" data-note="D">D</div>
                        <div class="piano-key black" data-note="D#">D#</div>
                        <div class="piano-key white" data-note="E">E</div>
                        <div class="piano-key white" data-note="F">F</div>
                        <div class="piano-key black" data-note="F#">F#</div>
                        <div class="piano-key white" data-note="G">G</div>
                        <div class="piano-key black" data-note="G#">G#</div>
                        <div class="piano-key white" data-note="A">A</div>
                        <div class="piano-key black" data-note="A#">A#</div>
                        <div class="piano-key white" data-note="B">B</div>
                        <div class="piano-key white" data-note="C2">C2</div>
                    </div>
                    <button class="start-btn" onclick="nextSong()">üéµ Pr√≥xima M√∫sica</button>
                </div>
            `;

            document.querySelectorAll('.piano-key').forEach(key => {
                key.addEventListener('click', () => {
                    const note = key.dataset.note;
                    if (pianoNotes[note]) {
                        playNote(pianoNotes[note], 0.5);
                        key.classList.add('playing');
                        setTimeout(() => key.classList.remove('playing'), 200);
                        checkPianoNote(note);
                    } else {
                        // Sharp notes
                        const sharpFreqs = { 'C#': 277.18, 'D#': 311.13, 'F#': 369.99, 'G#': 415.30, 'A#': 466.16 };
                        if (sharpFreqs[note]) {
                            playNote(sharpFreqs[note], 0.5);
                            key.classList.add('playing');
                            setTimeout(() => key.classList.remove('playing'), 200);
                        }
                    }
                });
            });
        }

        function checkPianoNote(note) {
            const song = pianoSongs[gameState.pianoSongIndex % pianoSongs.length];
            const expectedNote = song.notes[gameState.pianoNoteIndex];

            if (note === expectedNote) {
                // Correct note!
                const noteEl = document.querySelector(`.song-note[data-index="${gameState.pianoNoteIndex}"]`);
                noteEl.classList.remove('current');
                noteEl.classList.add('done');

                gameState.pianoNoteIndex++;
                addPoints(5);

                if (gameState.pianoNoteIndex >= song.notes.length) {
                    // Song complete!
                    showFeedback('üéâ M√∫sica completa! +50 pontos b√¥nus!', 'success');
                    addPoints(50);
                    setTimeout(nextSong, 2000);
                } else {
                    const nextNoteEl = document.querySelector(`.song-note[data-index="${gameState.pianoNoteIndex}"]`);
                    nextNoteEl.classList.add('current');
                }
            }
        }

        function nextSong() {
            gameState.pianoSongIndex++;
            loadMode('piano');
        }

        // RHYTHM MODE
        function loadRhythmMode(container) {
            container.innerHTML = `
                <div class="rhythm-container">
                    <div class="title">üéØ Jogo do Ritmo</div>
                    <div class="rhythm-display" id="rhythm-display"></div>
                    <div class="hit-zone" id="hit-zone">üéµ</div>
                    <button class="tap-btn" id="tap-btn">TAP!</button>
                    <button class="start-btn" onclick="startRhythm()">‚ñ∂Ô∏è Iniciar</button>
                </div>
            `;

            document.getElementById('tap-btn').addEventListener('click', rhythmTap);
        }

        function startRhythm() {
            // Generate random rhythm pattern
            const patterns = ['üî¥', 'üîµ', 'üü¢', 'üü°'];
            gameState.rhythmNotes = [];
            for (let i = 0; i < 8; i++) {
                gameState.rhythmNotes.push(patterns[Math.floor(Math.random() * patterns.length)]);
            }
            gameState.rhythmIndex = 0;

            const display = document.getElementById('rhythm-display');
            display.innerHTML = gameState.rhythmNotes.map((note, i) => `
                <div class="rhythm-note ${i === 0 ? 'current' : ''}" data-index="${i}">${note}</div>
            `).join('');

            playRhythmSequence();
        }

        function playRhythmSequence() {
            let i = 0;
            const interval = setInterval(() => {
                if (i >= gameState.rhythmNotes.length) {
                    clearInterval(interval);
                    document.getElementById('hit-zone').textContent = 'üéµ';
                    return;
                }

                document.querySelectorAll('.rhythm-note').forEach((el, idx) => {
                    el.classList.toggle('current', idx === i);
                });

                playNote(300 + i * 50, 0.2);
                i++;
            }, 600);
        }

        function rhythmTap() {
            const hitZone = document.getElementById('hit-zone');
            const currentNote = document.querySelector('.rhythm-note.current');

            if (currentNote) {
                currentNote.classList.remove('current');
                currentNote.classList.add('hit');
                playNote(440, 0.2);
                addPoints(10);

                hitZone.classList.add('perfect');
                setTimeout(() => hitZone.classList.remove('perfect'), 200);

                const nextIndex = parseInt(currentNote.dataset.index) + 1;
                const nextNote = document.querySelector(`.rhythm-note[data-index="${nextIndex}"]`);
                if (nextNote) {
                    nextNote.classList.add('current');
                } else {
                    showFeedback('üéâ Ritmo perfeito! +30 pontos b√¥nus!', 'success');
                    addPoints(30);
                }
            }
        }

        // Points and progress
        function addPoints(amount) {
            gameState.points += amount;
            gameState.streak++;
            if (gameState.streak > gameState.best) {
                gameState.best = gameState.streak;
            }

            // Check level up
            const newLevel = Math.floor(gameState.points / 200) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                showFeedback('üéâ Level Up! N√≠vel ' + gameState.level, 'success');
            }

            updateDisplay();
            updateMedals();
            saveProgress();
        }

        function showFeedback(text, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = text;
            feedback.className = 'feedback ' + type;
            feedback.style.display = 'block';
        }

        function hideFeedback() {
            document.getElementById('feedback').style.display = 'none';
        }

        function updateDisplay() {
            document.getElementById('points').textContent = gameState.points;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('best').textContent = gameState.best;
        }

        function updateMedals() {
            document.getElementById('medal-bronze').classList.toggle('earned', gameState.points >= 100);
            document.getElementById('medal-silver').classList.toggle('earned', gameState.points >= 500);
            document.getElementById('medal-gold').classList.toggle('earned', gameState.points >= 1000);
            document.getElementById('medal-diamond').classList.toggle('earned', gameState.points >= 2000);
        }

        function loadProgress() {
            const saved = localStorage.getItem('musicRhythmProgress');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.points = data.points || 0;
                gameState.level = data.level || 1;
                gameState.best = data.best || 0;
            }
        }

        function saveProgress() {
            localStorage.setItem('musicRhythmProgress', JSON.stringify({
                points: gameState.points,
                level: gameState.level,
                best: gameState.best
            }));
        }

        // Start
        init();
    </script>
</body>
</html>
