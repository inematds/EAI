<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Room Educativo - EAI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #ff5722, #ff9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        /* Stats */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .stat {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 80px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff5722;
        }

        .stat-label {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        /* Room Selection */
        .room-selection {
            text-align: center;
            padding: 40px;
        }

        .room-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 15px auto;
            padding: 20px;
            border: none;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .room-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .room-btn small {
            display: block;
            font-weight: normal;
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .room-btn.library {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
        }

        .room-btn.lab {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
        }

        .room-btn.museum {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        /* Game Area */
        .game-area {
            display: none;
        }

        .game-area.active {
            display: block;
        }

        /* Timer */
        .timer {
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: #ff5722;
            font-family: monospace;
        }

        .timer-display.warning {
            color: #f44336;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

        /* Room Display */
        .room-display {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .room-name {
            font-size: 1.3rem;
            color: #ff5722;
            margin-bottom: 10px;
        }

        .room-icon {
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .room-desc {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        /* Progress */
        .locks-progress {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .lock {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s;
        }

        .lock.unlocked {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            animation: unlock 0.5s;
        }

        .lock.current {
            border: 3px solid #ff5722;
            animation: pulse 1s infinite;
        }

        @keyframes unlock {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Puzzle */
        .puzzle-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .puzzle-title {
            text-align: center;
            margin-bottom: 15px;
            color: #ff9800;
            font-size: 1.1rem;
        }

        .puzzle-content {
            text-align: center;
            margin-bottom: 20px;
        }

        .puzzle-clue {
            font-size: 1rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .puzzle-image {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        /* Answer Input */
        .answer-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .answer-input {
            width: 100%;
            max-width: 300px;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1.2rem;
            text-align: center;
            outline: none;
            transition: all 0.3s;
        }

        .answer-input:focus {
            border-color: #ff5722;
        }

        .answer-input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        /* Multiple Choice */
        .choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 0 auto;
        }

        .choice {
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .choice:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        .choice.selected {
            border-color: #ff5722;
        }

        .choice.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.3);
        }

        .choice.wrong {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.3);
        }

        /* Hints */
        .hints-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .hint-btn {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #ff9800;
            color: #ff9800;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .hint-btn:hover {
            background: rgba(255, 152, 0, 0.3);
        }

        .hint-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .hint-display {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 152, 0, 0.1);
            border-radius: 10px;
            color: #ff9800;
            display: none;
        }

        .hint-display.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Feedback */
        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .feedback.success {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
        }

        .feedback.error {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
        }

        /* Actions */
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff5722, #ff9800);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Results */
        .results {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results.active {
            display: block;
        }

        .results-title {
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff5722, #ff9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 400px;
            margin: 0 auto 30px;
        }

        .result-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 16px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ff5722;
        }

        .result-label {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
        }

        /* Medals */
        .medals-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .medal {
            font-size: 2rem;
            opacity: 0.3;
            transition: all 0.3s;
        }

        .medal.earned {
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .timer-display {
                font-size: 2rem;
            }

            .choices {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Escape Room Educativo</h1>
            <p>Resolva os enigmas para escapar!</p>
        </div>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">Pontos</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="escapes">0</div>
                <div class="stat-label">Fugas</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="hints">3</div>
                <div class="stat-label">Dicas</div>
            </div>
        </div>

        <!-- Room Selection -->
        <div class="room-selection" id="roomSelection">
            <h2 style="margin-bottom: 30px;">Escolha a Sala</h2>

            <button class="room-btn library" onclick="startGame('library')">
                üìö Biblioteca Misteriosa
                <small>Enigmas de portugu√™s e literatura</small>
            </button>

            <button class="room-btn lab" onclick="startGame('lab')">
                üî¨ Laborat√≥rio Secreto
                <small>Desafios de ci√™ncias e matem√°tica</small>
            </button>

            <button class="room-btn museum" onclick="startGame('museum')">
                üèõÔ∏è Museu Encantado
                <small>Mist√©rios de hist√≥ria e geografia</small>
            </button>

            <div class="medals-container" style="margin-top: 30px;">
                <span class="medal" id="medal1">ü•â</span>
                <span class="medal" id="medal2">ü•à</span>
                <span class="medal" id="medal3">ü•á</span>
                <span class="medal" id="medal4">üèÜ</span>
                <span class="medal" id="medal5">üëë</span>
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area" id="gameArea">
            <!-- Timer -->
            <div class="timer">
                <div class="timer-display" id="timerDisplay">05:00</div>
            </div>

            <!-- Room Display -->
            <div class="room-display">
                <div class="room-icon" id="roomIcon">üìö</div>
                <div class="room-name" id="roomName">Biblioteca Misteriosa</div>
                <div class="room-desc" id="roomDesc">Resolva os enigmas para encontrar a chave!</div>
            </div>

            <!-- Progress -->
            <div class="locks-progress" id="locksProgress">
                <!-- Locks will be generated -->
            </div>

            <!-- Puzzle -->
            <div class="puzzle-container">
                <div class="puzzle-title" id="puzzleTitle">Enigma 1</div>
                <div class="puzzle-content">
                    <div class="puzzle-image" id="puzzleImage">üîç</div>
                    <div class="puzzle-clue" id="puzzleClue">Carregando enigma...</div>
                </div>
                <div class="answer-section" id="answerSection">
                    <!-- Answer input or choices will be generated -->
                </div>
            </div>

            <!-- Hints -->
            <div class="hints-section">
                <button class="hint-btn" id="hintBtn" onclick="useHint()">
                    üí° Usar Dica (<span id="hintsLeft">3</span>)
                </button>
                <div class="hint-display" id="hintDisplay"></div>
            </div>

            <!-- Feedback -->
            <div class="feedback" id="feedback">
                <span id="feedbackText"></span>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button class="btn btn-secondary" onclick="backToMenu()">
                    üè† Sair
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="results" id="results">
            <div class="results-title" id="resultsTitle">üéâ Voc√™ Escapou!</div>
            <p id="resultsDesc" style="margin-bottom: 20px; color: rgba(255,255,255,0.7);">Parab√©ns por resolver todos os enigmas!</p>

            <div class="results-stats">
                <div class="result-item">
                    <div class="result-value" id="finalScore">0</div>
                    <div class="result-label">Pontos</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalTime">00:00</div>
                    <div class="result-label">Tempo</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalHints">0</div>
                    <div class="result-label">Dicas Usadas</div>
                </div>
                <div class="result-item">
                    <div class="result-value" id="finalEscapes">0</div>
                    <div class="result-label">Total Fugas</div>
                </div>
            </div>

            <div class="medals-container">
                <span class="medal" id="resultMedal1">ü•â</span>
                <span class="medal" id="resultMedal2">ü•à</span>
                <span class="medal" id="resultMedal3">ü•á</span>
                <span class="medal" id="resultMedal4">üèÜ</span>
                <span class="medal" id="resultMedal5">üëë</span>
            </div>

            <div class="actions" style="margin-top: 30px;">
                <button class="btn btn-primary" onclick="startGame(currentRoom)">
                    üîÑ Jogar Novamente
                </button>
                <button class="btn btn-secondary" onclick="backToMenu()">
                    üè† Menu Principal
                </button>
            </div>
        </div>
    </div>

    <script>
        // Puzzles database
        const rooms = {
            library: {
                name: "Biblioteca Misteriosa",
                icon: "üìö",
                desc: "Resolva os enigmas liter√°rios para encontrar a chave!",
                puzzles: [
                    {
                        title: "O C√≥digo das Letras",
                        image: "üî§",
                        clue: "Complete a sequ√™ncia: A, C, E, G, ___",
                        type: "input",
                        answer: "I",
                        hint: "As letras pulam uma posi√ß√£o no alfabeto"
                    },
                    {
                        title: "A Palavra Escondida",
                        image: "üîç",
                        clue: "Rearranje as letras RVLIO para formar uma palavra.",
                        type: "input",
                        answer: "LIVRO",
                        hint: "√â algo que voc√™ encontra em uma biblioteca"
                    },
                    {
                        title: "O Enigma do Sin√¥nimo",
                        image: "üìñ",
                        clue: "Qual palavra significa o mesmo que 'FELIZ'?",
                        type: "choice",
                        choices: ["Triste", "Alegre", "Bravo", "Calmo"],
                        answer: 1,
                        hint: "√â o oposto de triste"
                    },
                    {
                        title: "A Frase Misteriosa",
                        image: "‚úçÔ∏è",
                        clue: "Complete: O menino ___ o livro. (passado de ler)",
                        type: "input",
                        answer: "LEU",
                        hint: "√â a conjuga√ß√£o do verbo LER no passado"
                    }
                ]
            },
            lab: {
                name: "Laborat√≥rio Secreto",
                icon: "üî¨",
                desc: "Use a ci√™ncia e matem√°tica para escapar!",
                puzzles: [
                    {
                        title: "A F√≥rmula Secreta",
                        image: "üß™",
                        clue: "Quanto √© 15 + 27?",
                        type: "input",
                        answer: "42",
                        hint: "Some as dezenas (10+20) e as unidades (5+7)"
                    },
                    {
                        title: "O Experimento",
                        image: "‚öóÔ∏è",
                        clue: "Qual estado f√≠sico da √°gua quando est√° a 100¬∞C?",
                        type: "choice",
                        choices: ["S√≥lido", "L√≠quido", "Gasoso", "Plasma"],
                        answer: 2,
                        hint: "A √°gua ferve e vira vapor"
                    },
                    {
                        title: "A Sequ√™ncia Num√©rica",
                        image: "üî¢",
                        clue: "Complete: 2, 4, 8, 16, ___",
                        type: "input",
                        answer: "32",
                        hint: "Cada n√∫mero √© o dobro do anterior"
                    },
                    {
                        title: "O Corpo Humano",
                        image: "ü´Ä",
                        clue: "Qual √≥rg√£o bombeia sangue pelo corpo?",
                        type: "choice",
                        choices: ["C√©rebro", "Pulm√£o", "Cora√ß√£o", "Est√¥mago"],
                        answer: 2,
                        hint: "Bate aproximadamente 100.000 vezes por dia"
                    }
                ]
            },
            museum: {
                name: "Museu Encantado",
                icon: "üèõÔ∏è",
                desc: "Desvende os mist√©rios da hist√≥ria!",
                puzzles: [
                    {
                        title: "O Mapa do Tesouro",
                        image: "üó∫Ô∏è",
                        clue: "Qual √© o maior pa√≠s da Am√©rica do Sul?",
                        type: "choice",
                        choices: ["Argentina", "Chile", "Brasil", "Peru"],
                        answer: 2,
                        hint: "Come√ßa com a letra B"
                    },
                    {
                        title: "A Rel√≠quia Antiga",
                        image: "üè∫",
                        clue: "Quantos estados tem o Brasil?",
                        type: "input",
                        answer: "26",
                        hint: "S√£o mais de 20 e menos de 30"
                    },
                    {
                        title: "O Enigma das Dire√ß√µes",
                        image: "üß≠",
                        clue: "O sol nasce em qual dire√ß√£o?",
                        type: "choice",
                        choices: ["Norte", "Sul", "Leste", "Oeste"],
                        answer: 2,
                        hint: "√â onde fica o lado 'direito' no mapa"
                    },
                    {
                        title: "A Data Hist√≥rica",
                        image: "üìÖ",
                        clue: "Em que dia comemoramos a Independ√™ncia do Brasil?",
                        type: "input",
                        answer: "7",
                        hint: "√â um n√∫mero entre 1 e 10, em setembro"
                    }
                ]
            }
        };

        // Game state
        let currentRoom = 'library';
        let currentPuzzleIndex = 0;
        let score = 0;
        let escapes = 0;
        let hints = 3;
        let hintsUsed = 0;
        let timeLeft = 300; // 5 minutes
        let timerInterval = null;
        let gameEnded = false;

        // Audio
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            switch(type) {
                case 'unlock':
                    oscillator.frequency.setValueAtTime(523, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(784, audioCtx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
                case 'wrong':
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'escape':
                    const notes = [523, 659, 784, 1047];
                    notes.forEach((freq, i) => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.15);
                        gain.gain.setValueAtTime(0.2, audioCtx.currentTime + i * 0.15);
                        osc.start(audioCtx.currentTime + i * 0.15);
                        osc.stop(audioCtx.currentTime + i * 0.15 + 0.15);
                    });
                    break;
                case 'timeout':
                    oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime + 0.2);
                    oscillator.frequency.setValueAtTime(100, audioCtx.currentTime + 0.4);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.6);
                    break;
            }
        }

        // Load progress
        function loadProgress() {
            const saved = localStorage.getItem('escapeRoomProgress');
            if (saved) {
                const data = JSON.parse(saved);
                score = data.score || 0;
                escapes = data.escapes || 0;
                updateMedals();
            }
            updateDisplay();
        }

        // Save progress
        function saveProgress() {
            localStorage.setItem('escapeRoomProgress', JSON.stringify({ score, escapes }));
        }

        // Update display
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('escapes').textContent = escapes;
            document.getElementById('hints').textContent = hints;
        }

        // Update medals
        function updateMedals() {
            const thresholds = [1, 3, 5, 10, 20];
            for (let i = 0; i < 5; i++) {
                const medal = document.getElementById(`medal${i + 1}`);
                if (escapes >= thresholds[i]) {
                    medal.classList.add('earned');
                }
            }
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Start timer
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timerDisplay').textContent = formatTime(timeLeft);

                if (timeLeft <= 60) {
                    document.getElementById('timerDisplay').classList.add('warning');
                }

                if (timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        // Stop timer
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Start game
        function startGame(room) {
            currentRoom = room;
            currentPuzzleIndex = 0;
            hints = 3;
            hintsUsed = 0;
            timeLeft = 300;
            gameEnded = false;

            const roomData = rooms[room];
            document.getElementById('roomIcon').textContent = roomData.icon;
            document.getElementById('roomName').textContent = roomData.name;
            document.getElementById('roomDesc').textContent = roomData.desc;

            document.getElementById('roomSelection').style.display = 'none';
            document.getElementById('gameArea').classList.add('active');
            document.getElementById('results').classList.remove('active');

            document.getElementById('timerDisplay').classList.remove('warning');
            document.getElementById('timerDisplay').textContent = formatTime(timeLeft);
            document.getElementById('hintsLeft').textContent = hints;

            // Generate locks
            const locksContainer = document.getElementById('locksProgress');
            locksContainer.innerHTML = '';
            roomData.puzzles.forEach((_, index) => {
                const lock = document.createElement('div');
                lock.className = 'lock';
                lock.id = `lock-${index}`;
                lock.textContent = 'üîí';
                locksContainer.appendChild(lock);
            });
            document.getElementById('lock-0').classList.add('current');

            loadPuzzle();
            startTimer();
            updateDisplay();
        }

        // Load puzzle
        function loadPuzzle() {
            const roomData = rooms[currentRoom];
            const puzzle = roomData.puzzles[currentPuzzleIndex];

            document.getElementById('puzzleTitle').textContent = `Enigma ${currentPuzzleIndex + 1}`;
            document.getElementById('puzzleImage').textContent = puzzle.image;
            document.getElementById('puzzleClue').textContent = puzzle.clue;

            const answerSection = document.getElementById('answerSection');
            answerSection.innerHTML = '';

            if (puzzle.type === 'input') {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'answer-input';
                input.placeholder = 'Digite sua resposta';
                input.id = 'answerInput';
                input.onkeypress = (e) => { if (e.key === 'Enter') checkAnswer(); };

                const btn = document.createElement('button');
                btn.className = 'btn btn-primary';
                btn.textContent = '‚úì Verificar';
                btn.onclick = checkAnswer;

                answerSection.appendChild(input);
                answerSection.appendChild(btn);
            } else {
                const choicesDiv = document.createElement('div');
                choicesDiv.className = 'choices';

                puzzle.choices.forEach((choice, index) => {
                    const btn = document.createElement('div');
                    btn.className = 'choice';
                    btn.textContent = choice;
                    btn.onclick = () => selectChoice(index);
                    choicesDiv.appendChild(btn);
                });

                answerSection.appendChild(choicesDiv);
            }

            document.getElementById('feedback').classList.remove('show');
            document.getElementById('hintDisplay').classList.remove('show');
        }

        // Check answer (input)
        function checkAnswer() {
            if (gameEnded) return;

            const input = document.getElementById('answerInput');
            const answer = input.value.trim().toUpperCase();
            const puzzle = rooms[currentRoom].puzzles[currentPuzzleIndex];
            const correct = puzzle.answer.toString().toUpperCase();

            if (answer === correct) {
                unlockPuzzle();
            } else {
                playSound('wrong');
                showFeedback('‚ùå Resposta incorreta. Tente novamente!', 'error');
                input.value = '';
            }
        }

        // Select choice
        function selectChoice(index) {
            if (gameEnded) return;

            const puzzle = rooms[currentRoom].puzzles[currentPuzzleIndex];
            const choices = document.querySelectorAll('.choice');

            choices.forEach((c, i) => {
                c.classList.remove('selected');
                if (i === puzzle.answer) {
                    c.classList.add('correct');
                } else if (i === index && index !== puzzle.answer) {
                    c.classList.add('wrong');
                }
            });

            if (index === puzzle.answer) {
                unlockPuzzle();
            } else {
                playSound('wrong');
                showFeedback('‚ùå Resposta incorreta. Tente novamente!', 'error');
            }
        }

        // Unlock puzzle
        function unlockPuzzle() {
            playSound('unlock');

            const lock = document.getElementById(`lock-${currentPuzzleIndex}`);
            lock.classList.remove('current');
            lock.classList.add('unlocked');
            lock.textContent = 'üîì';

            const points = 25 - (hintsUsed * 5);
            score += Math.max(points, 10);

            showFeedback(`üîì Correto! +${Math.max(points, 10)} pontos`, 'success');

            currentPuzzleIndex++;

            if (currentPuzzleIndex >= rooms[currentRoom].puzzles.length) {
                setTimeout(() => endGame(true), 1500);
            } else {
                document.getElementById(`lock-${currentPuzzleIndex}`).classList.add('current');
                setTimeout(loadPuzzle, 1500);
            }

            updateDisplay();
        }

        // Use hint
        function useHint() {
            if (hints <= 0 || gameEnded) return;

            hints--;
            hintsUsed++;
            document.getElementById('hintsLeft').textContent = hints;
            document.getElementById('hints').textContent = hints;

            const puzzle = rooms[currentRoom].puzzles[currentPuzzleIndex];
            document.getElementById('hintDisplay').textContent = `üí° ${puzzle.hint}`;
            document.getElementById('hintDisplay').classList.add('show');

            if (hints <= 0) {
                document.getElementById('hintBtn').disabled = true;
            }
        }

        // Show feedback
        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.className = `feedback ${type} show`;
            document.getElementById('feedbackText').textContent = message;
        }

        // End game
        function endGame(escaped) {
            gameEnded = true;
            stopTimer();

            if (escaped) {
                playSound('escape');
                escapes++;
                saveProgress();
                updateMedals();

                document.getElementById('resultsTitle').textContent = 'üéâ Voc√™ Escapou!';
                document.getElementById('resultsDesc').textContent = 'Parab√©ns por resolver todos os enigmas!';
            } else {
                playSound('timeout');
                document.getElementById('resultsTitle').textContent = '‚è∞ Tempo Esgotado!';
                document.getElementById('resultsDesc').textContent = 'O tempo acabou. Tente novamente!';
            }

            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('results').classList.add('active');

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalTime').textContent = formatTime(300 - timeLeft);
            document.getElementById('finalHints').textContent = hintsUsed;
            document.getElementById('finalEscapes').textContent = escapes;

            const thresholds = [1, 3, 5, 10, 20];
            for (let i = 0; i < 5; i++) {
                const medal = document.getElementById(`resultMedal${i + 1}`);
                if (escapes >= thresholds[i]) {
                    medal.classList.add('earned');
                }
            }
        }

        // Back to menu
        function backToMenu() {
            stopTimer();
            document.getElementById('roomSelection').style.display = 'block';
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('results').classList.remove('active');
        }

        // Initialize
        loadProgress();
    </script>
</body>
</html>
